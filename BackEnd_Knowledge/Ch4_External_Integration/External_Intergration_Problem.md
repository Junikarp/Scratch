# 외부 연동 문제
> 서비스에 문제가 없더라도 외부 서비스의 장애로 인해 서비스 영향을 받을 수 있다.
> 예를 들어 A 서비스에서는 트래픽을 감당하지만 B 서비스에서 트래픽을 감당하지 못해 A 서비스까지 장애가 발생 가능하다.
> 때문에 외부 서비스의 문제를 완전히 차단하진 못하더라도 영향을 줄이는 기법을 사용하면 좋다.

## 타임아웃
> 외부 연동에 대한 적절한 타임아웃 설정은 응답 시간을 통해 성능 저하의 영향을 줄일 수 있다.
> 요청을 대기하는 시간이 너무 길어지면 서비스의 처리량을 초과하여 마비될 수 있기 때문

###  연결 타임아웃
* 클라이언트가 서버에 연결을 요청하는 시점에 발생
* 클라이언트와 서버가 연결하기 위한 TCP 3-way handshake 가 시간내 완료되지 않으면 발생
* 3초 ~ 5초 정도로 지정 후 조정하는 것을 권장
### 읽기 타임아웃
* 연결을 성공한 후 서버로부터 응답 데이터를 기다리는 시점에 발생
* 클라이언트-서버의 연결이 성공적으로 완료된 후 서버로부터 데이터를 읽어들이는 시간이 지정 시간을 초과 시 발생
* 5초 ~ 30초 정도로 지정후 조정하는 것을 권장
---

## 재시도
> 네트워크 통신 과정에서 간헐적인 연결실패나 일시적 응답 오류는 재시도를 통해 해결 가능할 수 있다.
> 단 재시도가 가능한 경우에만 재시도를 해야한다.(아님 불필요한 처리가 중복으로 될 수도 있다.)

### 재시도 가능 조건
1. 단순 조회 기능
   * 단순 조회 기능은 데이터에 영향을 주지 않으므로 재시도가 가능하다.
2. 연결 타임아웃
   * 연결 타임아웃 발생은 연동 서비스 연결이 안됐다는 뜻이므로 재시도가 가능하다.
   * 연동 서비스에 연결되지 않으면 요청을 처리하지 못하기 때문
   * 단, 읽기 타임아웃은 요청을 처리하고 있을 가능성이 있으므로 재시도 하지 않는 것을 권장
3. 멱등성을 가진 변경 기능
   * 연산을 반복해도 같은 값을 반환하는 멱등성이 있는 기능에는 재시도 가능 

이외에도 여러 이유로 실패가 발생할텐데 발생 원인에 따라 재시도 여부를 고려해야한다.

### 재시도 횟수와 간격
> 재시도 고려시에는 재시도 횟수와 재시도 간격 두가지를 고려해야 한다.

재시도는 1회 ~ 2회 정도 간격은 네트워크 연결 상태에 따라 조정한다.

### 재시도 폭풍 안티패턴
> 재시도 시에는 연동 서비스의 상황도 고려해야한다.
> 재시도로 인해 요청 수가 증가하여 부하가 올 수 있기 때문
 
---
 



