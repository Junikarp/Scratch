# 서버 성능 개선
> 서버 성능을 위해 고려할 만한 요소들에 대한 정리입니다.

---
## 처리량과 응답시간

### 응답시간이란?
> 사용자의 요청을 처리하는데 걸리는 시간
> 서버에 연결하고 데이터를 전송하는 시간을 포함한다.

### 처리량이란?
> 단위 시간당 시스템이 처리하는 작업량을 의미하며 아래와 같은 단위로 나타낸다.
> TPS(transaction per second : 초당 트랙잭션 수)
> RPS(request per second : 초당 요청 수)

성능 개선을 위해서는 현재 서버의 처리량과 응답 시간을 알고 현재 수치와 목표치를 적절히 설정해야 한다.

---
## 병목 지점
> 성능을 향상시키기 위해서는 처리 시간이 오래 걸리는 작업을 식별해야한다.
> 이를 위해 적절한 모니터링 도구를 사용하면 효율적이다.
> [성능 테스트 툴 소개글](https://velog.io/@dongvelop/%EC%84%B1%EB%8A%A5%ED%85%8C%EC%8A%A4%ED%8A%B8-%ED%88%B4-%EC%86%8C%EA%B0%9C)
---
## 수직 확장 & 수평 확장
> 수직 확장과 수평 확장은 말그대로 자원을 증가시키는 행위로 가장 기본적인 성능 증가 방안이라 볼 수 있겠다.

### 수직 확장 (Scale-up)
> 수직확장은 하나의 시스템에 더 강력한 자원(CPU, RAM, 디스크 등)을 추가하여 성능을 높이는 방식
> 클라우드 환경에서 빠르게 시도 가능하다.
> 하나의 시스템에 추가할 수 있는 자원에 제한이 있기 때문에 한계가 명확

### 수평 확장 (Scale-out)
> 여러 대의 서버를 추가하여 부하를 분산하는 방식
> 이론적으로 무한적인 확장이 가능하지만 분산 시스템의 관리가 복잡
> 부하를 분산해주는 로드 밸런싱이 필수적으로 동반됨

---
## DB 커넥션 풀
> DB 를 연결하고 종료하는데 소요되는 시간을 줄이기 위한 방안
> DB 에 연결된 커넥션을 미리 생성해서 보관하다가 필요할 때 꺼내 사용 후 반환하는 방식

### 커넥션 풀 크기
> 미리 생성해 둘 커넥션의 크기를 지정하는 설정
> 커넥션 풀 설정에서 가장 중요한 부분 -> 적절한 설정 필요
> 크기가 너무 적으면 대기 시간이 증가하고 너무 크면 서버 CPU 사용률의 증가로 쿼리 시간 증가 가능

### 커넥션 대기시간
> 커넥션이 없을 때 기다릴 수 있는 최대 시간
> 대기 시간을 짧게 설정하면 빠르게 에러를 반환하여 서버 부하 증가를 방지하는 것이 가능
> 보통 0.5 ~ 3초로 지정

### 최대 유휴시간
> 사용되지 않은 커넥션을 풀에 유지할 수 있는 최대 시간

### 유효성 검사
> 커넥션이 정상적으로 사용할 수 있는 상태인지 확인하는 절차

### 최대 유지시간
> 커넥션이 풀에 유지되는 시간
> 시간이 지나면 커넥션을 닫고 풀에서 제거됨

---

## 서버 캐시

### 적중률과 삭제규칙

### 로컬 캐시 & 리모트 캐시

### 캐시 사전적재

### 캐시 무효화

## GC 와 메모리 사용

### 응답 데이터 압축

## 정적 자원 & 브라우저 캐시

### CDN

## 대기 처리
> 위와 같은 성능 개선을 위한 노력에도 불구하고 더 이상 개선이 불가한 상황이 존재할 수 있다.
> 물론 서버와 DB를 늘려 처리량을 늘리는 방안도 가능하겠지만 전체 서비스에서 일부에 불과한 
> 시간동안 트래픽을 처리하기 위해 자원을 늘리는 행위는 비용 측면에서 그리 효율적이지 않은 느낌이다.
> 이 때 시스템을 무작정 늘리기보다는 수용 가능한 트래픽 이외의 트래픽은 대기처리 하는 방안을 고려가능하다.

